FROM alpine:latest
MAINTAINER Erick Torres <erick@schibsted.cl>

ARG GIT_COMMIT
ARG GIT_BRANCH
ARG BUILD_CREATOR
ARG APPNAME
ARG VERSION
ARG BINARY
ARG EXPOSE_PORT
ARG SYSLOG_ENABLED
ARG SYSLOG_IDENTITY
ARG LOG_LEVEL
ARG STDLOG_ENABLED

ENV EXEC ./$BINARY
ENV LISTEN_PORT $EXPOSE_PORT
ENV MODE DOCKER
ENV VERSION $VERSION
ENV SERVERNAME "0.0.0.0" 
ENV SYSLOG_ENABLED $SYSLOG_ENABLED
ENV SYSLOG_IDENTITY $ SYSLOG_IDENTITY
ENV LOG_LEVEL $LOG_LEVEL
ENV STDLOG_ENABLED $STDLOG_ENABLED

LABEL branch=$GIT_BRANCH \
   commit=$GIT_COMMIT \
   build-creator=$BUILD_CREATOR \
   appname=$APPNAME \
   version=$VERSION

COPY ${BINARY} /home/user/app/
RUN touch /home/user/app/$GIT_COMMIT
WORKDIR /home/user/app/

EXPOSE ${LISTEN_PORT}

CMD $EXEC
